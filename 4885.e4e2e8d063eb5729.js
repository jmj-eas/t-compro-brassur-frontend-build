"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4885],{385:(O,E,c)=>{c.d(E,{l:()=>M});var j=c(5312),n=c(4438),l=c(2767),m=c(7343),g=c(177);const S=[[["","left",""]],[["","right",""]],"*"],e=["[left]","[right]","*"];function x(d,_){1&d&&n.nrm(0,"ion-back-button",10)}function z(d,_){1&d&&n.nrm(0,"ion-menu-button",11)}function R(d,_){if(1&d){const h=n.RV6();n.j41(0,"ion-button",12),n.bIt("click",function(){n.eBV(h);const p=n.XpG();return n.Njj(p.close())}),n.nrm(1,"ion-icon",13),n.k0s()}}function V(d,_){if(1&d&&(n.j41(0,"p"),n.EFF(1),n.k0s()),2&d){const h=n.XpG();n.R7$(),n.JRh(h.apiUrl)}}function F(d,_){1&d&&(n.j41(0,"ion-item",14)(1,"ion-label",15),n.EFF(2,"Off-Line"),n.k0s()())}let M=(()=>{class d{constructor(h,v){this.jmjModoConexionService=h,this.modalCtrl=v,this.menuType="back",this.apiUrl="",this.modo="prod"}ngOnInit(){this.apiUrl=j.c.apiUrl,this.modo=this.apiUrl.slice(-4)}close(){this.modalCtrl.dismiss(null)}static{this.\u0275fac=function(v){return new(v||d)(n.rXU(l.B),n.rXU(m.W3))}}static{this.\u0275cmp=n.VBU({type:d,selectors:[["app-header"]],inputs:{title:"title",menuType:"menuType"},ngContentSelectors:e,decls:14,vars:6,consts:[["no-border","","translucent",""],["color","success"],["slot","start"],["defaultHref","/",4,"ngIf"],["menu","appMenu",4,"ngIf"],[3,"click",4,"ngIf"],[1,"titulo"],[4,"ngIf"],["slot","end",1,"right-buttons"],["color","success","lines","none",4,"ngIf"],["defaultHref","/"],["menu","appMenu"],[3,"click"],["name","close","slot","icon-only"],["color","success","lines","none"],["color","danger"]],template:function(v,p){1&v&&(n.NAR(S),n.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),n.DNE(3,x,1,0,"ion-back-button",3)(4,z,1,0,"ion-menu-button",4)(5,R,2,0,"ion-button",5),n.SdG(6),n.k0s(),n.j41(7,"ion-title",6),n.EFF(8),n.k0s(),n.DNE(9,V,2,1,"p",7),n.j41(10,"ion-buttons",8),n.DNE(11,F,3,0,"ion-item",9),n.SdG(12,1),n.k0s()(),n.SdG(13,2),n.k0s()),2&v&&(n.R7$(3),n.Y8G("ngIf","back"===p.menuType),n.R7$(),n.Y8G("ngIf","menu"===p.menuType),n.R7$(),n.Y8G("ngIf","modal"===p.menuType),n.R7$(3),n.JRh(p.title),n.R7$(),n.Y8G("ngIf","test"===p.modo),n.R7$(2),n.Y8G("ngIf",p.jmjModoConexionService.getModoOffLine()))},dependencies:[g.bT,m.Jm,m.QW,m.eU,m.iq,m.uz,m.he,m.MC,m.BC,m.ai,m.el],styles:[".titulo[_ngcontent-%COMP%]{color:#fff}ion-icon[_ngcontent-%COMP%]{color:#fff}.sc-ion-buttons-ios-h.ion-color.sc-ion-buttons-ios-s[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%], .ion-color[_ngcontent-%COMP%]   .sc-ion-buttons-ios-h.sc-ion-buttons-ios-s[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%], .sc-ion-buttons-md-h.ion-color.sc-ion-buttons-md-s[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%], .ion-color[_ngcontent-%COMP%]   .sc-ion-buttons-md-h.sc-ion-buttons-md-s[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{color:#fff}"]})}}return d})()},4885:(O,E,c)=>{c.r(E),c.d(E,{JmjTransferenciaValoresPageModule:()=>$});var j=c(177),n=c(9417),l=c(7343),m=c(1050),g=c(467),S=c(5312),e=c(4438),x=c(2130),z=c(2464),R=c(1527),V=c(5032),F=c(3943),M=c(2767),d=c(2226),_=c(5161),h=c(385);function v(a,b){if(1&a&&(e.j41(0,"ion-row",28)(1,"ion-col",29)(2,"ion-text",30)(3,"strong"),e.EFF(4),e.k0s()()(),e.j41(5,"ion-col",29),e.EFF(6),e.nI1(7,"number"),e.k0s()()),2&a){const o=b.$implicit;e.R7$(4),e.JRh(o.desTipoValor),e.R7$(2),e.JRh(e.i5U(7,2,o.monto,"1.0-0"))}}function p(a,b){if(1&a&&(e.j41(0,"ion-row")(1,"ion-col",31)(2,"ion-text",32)(3,"small"),e.EFF(4),e.k0s()()()()),2&a){const o=e.XpG().$implicit;e.R7$(4),e.Lme("Habilitaci\xf3n: ",o.habilitacion," | Caja: ",o.caja,"")}}function k(a,b){if(1&a){const o=e.RV6();e.j41(0,"ion-row",20)(1,"ion-col",21)(2,"ion-checkbox",22),e.mxI("ngModelChange",function(i){const s=e.eBV(o).$implicit;return e.DH7(s.seleccionado,i)||(s.seleccionado=i),e.Njj(i)}),e.bIt("ionChange",function(){const i=e.eBV(o).$implicit,s=e.XpG(2);return e.Njj(s.seleccion(i.id))}),e.k0s()(),e.j41(3,"ion-col",23),e.EFF(4),e.k0s(),e.j41(5,"ion-col",24),e.EFF(6),e.k0s(),e.j41(7,"ion-col",25),e.EFF(8),e.k0s(),e.j41(9,"ion-col",26),e.EFF(10),e.nI1(11,"number"),e.k0s(),e.j41(12,"ion-grid"),e.DNE(13,v,8,5,"ion-row",27)(14,p,5,2,"ion-row",3),e.k0s()()}if(2&a){const o=b.$implicit;e.R7$(2),e.R50("ngModel",o.seleccionado),e.R7$(2),e.JRh(o.id),e.R7$(2),e.JRh(o.nombreTipoEnvio),e.R7$(2),e.JRh(o.remitente),e.R7$(2),e.JRh(e.i5U(11,7,o.montoTotal,"1.0-0")),e.R7$(3),e.Y8G("ngForOf",o.valores),e.R7$(),e.Y8G("ngIf",o.habilitacion&&o.caja)}}function I(a,b){if(1&a&&(e.j41(0,"div")(1,"ion-item",17)(2,"ion-label",18),e.EFF(3,"TOTAL VALORES : "),e.k0s(),e.j41(4,"p",19),e.EFF(5),e.nI1(6,"number"),e.k0s()(),e.j41(7,"ion-item")(8,"ion-text",33),e.EFF(9,"Hay diferencias entre las cabeceras y los detalles"),e.k0s()()()),2&a){const o=e.XpG(2);e.R7$(5),e.JRh(e.i5U(6,1,o.importeRecibidoDet,"1.0-0"))}}function y(a,b){if(1&a&&(e.j41(0,"ion-grid")(1,"ion-row",7)(2,"ion-col",8)(3,"ion-list")(4,"ion-grid")(5,"ion-row",9)(6,"ion-item-divider",10)(7,"ion-col",11),e.EFF(8,"Id"),e.k0s(),e.j41(9,"ion-col",12),e.EFF(10,"Tipo Envio"),e.k0s(),e.j41(11,"ion-col",12),e.EFF(12,"Remit"),e.k0s(),e.j41(13,"ion-col",13),e.EFF(14,"Importe"),e.k0s()()(),e.DNE(15,k,15,10,"ion-row",14),e.k0s(),e.j41(16,"ion-row",15)(17,"ion-col",16)(18,"ion-item",17)(19,"ion-label",18),e.EFF(20,"TOTAL GENERAL : "),e.k0s(),e.j41(21,"p",19),e.EFF(22),e.nI1(23,"number"),e.k0s()(),e.DNE(24,I,10,4,"div",3),e.k0s()()()()()()),2&a){const o=e.XpG();e.R7$(15),e.Y8G("ngForOf",o.iJmjTransferenciaValores),e.R7$(7),e.JRh(e.i5U(23,3,o.importeRecibidoCab,"1.0-0")),e.R7$(2),e.Y8G("ngIf",0!==o.importeTotalDif)}}let J=(()=>{class a{constructor(o,t,i,s,u,f,r,T,C){if(this.apiSvc=o,this.authSvc=t,this.route=i,this.alertSvc=s,this.navCtrl=u,this.jmjStorageService=f,this.jmjModoConexionService=r,this.jmjTomarDatosGlobales=T,this.loaderSvc=C,this.habilitacion=0,this.caja=0,this.tipo=this.route.snapshot.paramMap.get("tipo"),this.jmjModoConexionService.getModoOffLine())return this.alertSvc.success("Para enviar o recibir valores debe tener conexi\xf3n"),void this.navCtrl.navigateBack("/jmj-home")}ngOnInit(){if(this.jmjModoConexionService.getModoOffLine())return this.alertSvc.success("Para enviar o recibir valores debe tener conexi\xf3n"),void this.navCtrl.navigateBack("/jmj-home");this.iJmjTransferenciaValores=[],"recibir"===this.tipo?(this.finalizarLabel="Recibir",this.titulo="Valores a recibir",this.recuperarDatos()):"enviar"===this.tipo&&(this.finalizarLabel="Enviar",this.titulo="Valores a enviar",this.asignarDatos())}doRefresh(o){var t=this;return(0,g.A)(function*(){if(t.jmjModoConexionService.getModoOffLine())return o.target.complete(),t.alertSvc.success("Para enviar o recibir valores debe tener conexi\xf3n"),void t.navCtrl.navigateBack("/jmj-home");yield t.recuperarDatos(),o.target.complete(),setTimeout(()=>{o.target.complete()},2e3)})()}getIdpersonaFromToken(){try{const o=this.authSvc.getToken();return o&&JSON.parse(atob(o.split(".")[1])).idpersona||null}catch(o){return console.warn("No se pudo extraer idpersona del token:",o),null}}recuperarDatos(){var o=this;return(0,g.A)(function*(){yield o.loaderSvc.show("Cargando");const t=o.getIdpersonaFromToken();if(!t)return o.loaderSvc.stop(),void o.alertSvc.error("No se pudo obtener el idpersona del token");o.apiSvc.get("/valores/envios/"+t).subscribe(function(){var i=(0,g.A)(function*(s){o.loaderSvc.stop();const u=s.data||s;if(!u||0===u.length)return o.iJmjTransferenciaValores=[],void o.validaciones();const f=new Map;u.forEach(r=>{const T=r.id_envio;f.has(T)||f.set(T,{id:T,habilitacion:r.habilitacion,caja:r.caja,responsable:r.responsable,nombre_responsable:r.nombre_responsable,fecha_apertura:r.fecha_apertura,observacion:r.observacion,remitente:r.remitente,nombre_remitente:r.nombre_remitente,destinatario:r.destinatario,nombre_destinatario:r.nombre_destinatario,tipo_envio:r.tipo_envio,descripcion:r.descripcion,valores:[],importeTotal:0});const C=f.get(T),P=("string"==typeof r.importe?parseFloat(r.importe):r.importe)*(r.signo||1);C.valores.push({id:C.valores.length+1,tipoValor:r.tipo_valor,desTipoValor:o.getDescripcionTipoValor(r.tipo_valor),monto:P,nro_valor:r.nro_valor}),C.importeTotal+=P}),o.iJmjTransferenciaValores=Array.from(f.values()).map(r=>({id:r.id,remitente:r.nombre_remitente||r.remitente?.toString(),montoTotal:r.importeTotal,tipoEnvio:r.tipo_envio?.toString(),nombreTipoEnvio:r.descripcion||"Env\xedo de Valores",seleccionado:!1,valores:r.valores,habilitacion:r.habilitacion,caja:r.caja,talonario:null})),o.iJmjTransferenciaValores.length>0&&(o.idSeleccionado=o.iJmjTransferenciaValores[0].id),o.validaciones()});return function(s){return i.apply(this,arguments)}}(),i=>{o.loaderSvc.stop(),o.alertSvc.error("Error al obtener transferencias: "+(i.error?.message||i.message||"Error desconocido"))})})()}asignarDatos(){var o=this;return(0,g.A)(function*(){const t=yield o.jmjStorageService.getData("CAJA_DATA");if(t&&"undefined"!==t){const s=JSON.parse(t);o.habilitacion=s.habilitacion||0,o.caja=s.caja||0}const i=o.jmjTomarDatosGlobales.getBilletera()?o.jmjTomarDatosGlobales.getBilletera().saldo:0;if(!i||i<=0)return o.iJmjTransferenciaValores=[],o.alertSvc.info("No hay valores a rendir. El monto a rendir es cero."),void o.validaciones();o.iJmjTransferenciaValor={remitente:o.authSvc.getUserInfo().usuario,id:1,montoTotal:i,nombreTipoEnvio:"Env\xedo de Valores",seleccionado:!1,tipoEnvio:"1",valores:[{id:1,tipoValor:"E",monto:i,desTipoValor:o.getDescripcionTipoValor("E")}],talonario:null,habilitacion:o.habilitacion,caja:o.caja},o.iJmjTransferenciaValores.push(o.iJmjTransferenciaValor),o.validaciones()})()}getDescripcionTipoValor(o){return"E"===o?"Efectivo":"T"===o?"Transferencia":"C"===o?"Cheque":"Desconocido"}validaciones(){this.importeRecibidoCab=this.iJmjTransferenciaValores.reduce((o,t)=>o+t.montoTotal,0),this.importeRecibidoDet=this.iJmjTransferenciaValores.map(o=>o.valores.reduce((t,i)=>t+i.monto,0)).reduce((o,t)=>o+t,0),this.importeTotalDif=this.importeRecibidoCab-this.importeRecibidoDet}seleccion(o){const t=this.iJmjTransferenciaValores.find(i=>i.id===o);t&&(t.seleccionado&&this.idSeleccionado===o?(t.seleccionado=!1,this.idSeleccionado=null):(this.idSeleccionado=o,this.iJmjTransferenciaValores.forEach(i=>{i.seleccionado=i.id===o})))}autorizarTransaccion(){var o=this;return(0,g.A)(function*(){if(o.validaciones(),yield o.loaderSvc.show("Cargando"),"recibir"===o.tipo){const t=o.iJmjTransferenciaValores.find(f=>f.id===o.idSeleccionado);if(!t)return o.loaderSvc.stop(),void o.alertSvc.error("No se encontr\xf3 el env\xedo seleccionado");if(!t.habilitacion||!t.caja)return o.loaderSvc.stop(),void o.alertSvc.error("El env\xedo no tiene los datos completos (habilitaci\xf3n o caja)");const i=o.authSvc.getIdubi()||S.c.idubi||"",s=o.authSvc.getUserInfo()?.usuario||"";if(!i)return o.loaderSvc.stop(),void o.alertSvc.error("No se pudo obtener el idubi");if(!s)return o.loaderSvc.stop(),void o.alertSvc.error("No se pudo obtener el idusuario");o.apiSvc.post("/valores/confirmarEnvio",{idubi:i,habilitacion:t.habilitacion,caja:t.caja,id_envio:t.id,estado:"CONF",idusuario:s}).subscribe(function(){var f=(0,g.A)(function*(r){o.loaderSvc.stop(),200===r.status?(o.alertSvc.success(r.message||"Transferencia confirmada exitosamente!"),o.navCtrl.navigateBack("/jmj-home")):o.alertSvc.error(r.message||"Error al confirmar la transferencia")});return function(r){return f.apply(this,arguments)}}(),f=>{o.loaderSvc.stop(),o.alertSvc.error("Error al confirmar transferencia: "+(f.error?.message||f.message||"Error desconocido"))})}else if("enviar"===o.tipo){if(o.iJmjTransferenciaValor=o.iJmjTransferenciaValores[0],!o.iJmjTransferenciaValor.habilitacion||!o.iJmjTransferenciaValor.caja)return o.loaderSvc.stop(),void o.alertSvc.error("Faltan datos de habilitaci\xf3n o caja. Por favor, recargue la p\xe1gina.");if(!o.iJmjTransferenciaValor.montoTotal||o.iJmjTransferenciaValor.montoTotal<=0)return o.loaderSvc.stop(),void o.alertSvc.error("El monto total debe ser mayor a cero.");const t={habilitacion:o.iJmjTransferenciaValor.habilitacion,caja:o.iJmjTransferenciaValor.caja,montoTotal:o.iJmjTransferenciaValor.montoTotal};console.log("Enviando rendici\xf3n:",t),o.apiSvc.post("/valores/rendicion",t).subscribe({next:(i=(0,g.A)(function*(s){o.loaderSvc.stop(),o.alertSvc.success(s.message||"Rendici\xf3n enviada exitosamente!"),setTimeout(()=>{o.navCtrl.navigateBack("/jmj-home")},1e3)}),function(u){return i.apply(this,arguments)}),error:i=>{o.loaderSvc.stop(),console.error("Error al enviar rendici\xf3n:",i);let s="Error al procesar la rendici\xf3n";i.error?i.error.message?s=i.error.message:"string"==typeof i.error&&(s=i.error):i.message&&(s=i.message),o.alertSvc.error(s)}})}var i})()}close(){this.navCtrl.navigateBack("/jmj-home")}static{this.\u0275fac=function(t){return new(t||a)(e.rXU(x.G),e.rXU(z.u),e.rXU(m.nX),e.rXU(R.u),e.rXU(V.q9),e.rXU(F.y),e.rXU(M.B),e.rXU(d.C),e.rXU(_.Z))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-jmj-transferencia-valores"]],decls:10,vars:4,consts:[[3,"title"],["slot","fixed",3,"ionRefresh"],["pullingIcon","chevron-down-circle-outline","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refrescando..."],[4,"ngIf"],[1,"animated","fadeIn","fast"],["expand","full","color","medium","size","large",1,"ion-no-padding","ion-no-margin",3,"click","disabled"],["expand","full","color","danger","size","large",1,"ion-no-padding","ion-no-margin",3,"click"],[1,"ion-justify-content-center"],["size","12"],[1,"item-divider"],["size","12",1,"item-divider"],["size-xs","1.1","size-sm","1","size-md","1","size-lg","1","size-xl","1",1,"ion-text-start","ion-hide-sm-down","ion-no-padding","ion-no-margin"],["size-xs","4","size-sm","3","size-md","0.5","size-lg","1","size-xl","1",1,"ion-text-start"],["size-xs","3.5","size-sm","3.2","size-md","2.5","size-lg","1","size-xl","1",1,"ion-text-end"],["class","datarow-cab",4,"ngFor","ngForOf"],[1,"ion-justify-content-center","ion-no-padding","ion-no-margin"],["size","12",1,"ion-text-end"],[1,"ion-text-end","ion-no-padding","ion-no-margin"],[1,"ion-text-center","ion-padding-end"],[1,"total"],[1,"datarow-cab"],["size-xs","0.5","size-sm","0.1","size-md","0.5","size-lg","0.1","size-xl","0.1",1,"ion-text-start","seleccionar","ion-padding-end"],[1,"ion-text-start","seleccionar",3,"ngModelChange","ionChange","ngModel"],["size-xs","1.2","size-sm","1","size-md","0.5","size-lg","1","size-xl","1",1,"ion-text-start","ion-hide-sm-down","idenvio"],["size-xs","3","size-sm","3","size-md","3","size-lg","1","size-xl","1",1,"ion-text-start","tipoenvio"],["size-xs","3.5","size-sm","3.5","size-md","3","size-lg","1","size-xl","1",1,"ion-text-start"],["size-xs","3.5","size-sm","3","size-md","3","size-lg","1","size-xl","1",1,"ion-text-end"],["class","datarow-det ion-justify-content-end ion-padding-end",4,"ngFor","ngForOf"],[1,"datarow-det","ion-justify-content-end","ion-padding-end"],["size-xs","4","size-sm","4","size-md","5","size-lg","6","size-xl","6",1,"ion-text-end"],["color","primary"],["size-xs","11","size-sm","11","size-md","11","size-lg","11","size-xl","11",1,"ion-text-end"],["color","medium"],["color","danger"]],template:function(t,i){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(u){return i.doRefresh(u)}),e.nrm(3,"ion-refresher-content",2),e.k0s(),e.DNE(4,y,25,6,"ion-grid",3),e.k0s(),e.j41(5,"ion-footer",4)(6,"ion-button",5),e.bIt("click",function(){return i.autorizarTransaccion()}),e.EFF(7),e.k0s(),e.j41(8,"ion-button",6),e.bIt("click",function(){return i.close()}),e.EFF(9,"Cancelar "),e.k0s()()),2&t&&(e.Y8G("title",i.titulo),e.R7$(4),e.Y8G("ngIf",i.iJmjTransferenciaValores.length>0),e.R7$(2),e.Y8G("disabled",0!==i.importeTotalDif||!i.idSeleccionado),e.R7$(),e.SpI("",i.finalizarLabel," "))},dependencies:[j.Sq,j.bT,n.BC,n.vS,l.Jm,l.eY,l.hU,l.W9,l.M0,l.lO,l.uz,l.Dg,l.he,l.nf,l.To,l.Ki,l.ln,l.IO,l.hB,h.l,j.QX],styles:[".item-divider[_ngcontent-%COMP%]{font-size:.8rem}.datarow-cab[_ngcontent-%COMP%]{font-size:.8rem;background-color:#f5f5f5;margin-bottom:10px}.datarow-det[_ngcontent-%COMP%]{font-size:.8rem}.seleccionar[_ngcontent-%COMP%]{font-size:1px}.tipoenvio[_ngcontent-%COMP%], .idenvio[_ngcontent-%COMP%]{margin-left:10px}"]})}}return a})();const D=[{path:"",component:J},{path:":tipo",component:J}];let U=(()=>{class a{static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[m.iI.forChild(D),m.iI]})}}return a})();var G=c(9244);let $=(()=>{class a{static{this.\u0275fac=function(t){return new(t||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[j.MD,n.YN,l.bv,U,G.Q]})}}return a})()}}]);